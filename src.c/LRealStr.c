/* file generated by oo2c -- do not edit */
#include "__oo2c.h"
#include "__libc.h"
#include "LRealStr.d"

static _ModId _mid;

void LRealStr__StrToReal(const unsigned char* str__ref, int str_0d, double *real, signed char *res) {
  register int i0;
  register double d0;
  unsigned char* str;
  char* _old_top_vs = _top_vs;
  _push_value(int, str, str__ref, str_0d);
  i0 = LRealConv__FormatReal((const unsigned char*)(int)str, str_0d);
  *res = i0;
  i0 = *res;
  i0 = (0x3U & ((unsigned int)1 << i0)) != 0;
  if (!(i0)) goto l0;
  d0 = LRealConv__ValueReal((const unsigned char*)(int)str, str_0d);
  *real = d0;
l0:
  _top_vs = _old_top_vs;
}

void LRealStr__AppendChar(unsigned char ch, unsigned char* str, int str_0d) {
  register int i0;
  unsigned char ds[2];
  i0 = (int)ds + 1;
  *(unsigned char*)(int)ds = (int)ch;
  *(unsigned char*)i0 = 0;
  Strings__Append((const unsigned char*)(int)ds, 2, (unsigned char*)(int)str, str_0d);
}

void LRealStr__AppendDigit(int dig, unsigned char* str, int str_0d) {
  register int i0;
  i0 = dig + 48;
  LRealStr__AppendChar((unsigned char)i0, (unsigned char*)(int)str, str_0d);
}

void LRealStr__AppendExponent(short int exp, unsigned char* str, int str_0d) {
  register int i0, i1;
  i0 = exp < 0;
  Strings__Append((const unsigned char*)(int)_c0, 2, (unsigned char*)(int)str, str_0d);
  if (i0) goto l0;
  Strings__Append((const unsigned char*)(int)_c1, 2, (unsigned char*)(int)str, str_0d);
  i0 = exp;
  goto l1;
l0:
  Strings__Append((const unsigned char*)(int)_c2, 2, (unsigned char*)(int)str, str_0d);
  i0 = - exp;
l1:
  i1 = i0 < 100;
  if (i1) goto l2;
  _div(i1, i0, 100, short int);
  LRealStr__AppendDigit((int)i1, (unsigned char*)(int)str, str_0d);
l2:
  i1 = i0 >= 10;
  if (!(i1)) goto l3;
  _div(i1, i0, 10, short int);
  _mod(i1, i1, 10, short int);
  LRealStr__AppendDigit((int)i1, (unsigned char*)(int)str, str_0d);
l3:
  _mod(i0, i0, 10, short int);
  LRealStr__AppendDigit((int)i0, (unsigned char*)(int)str, str_0d);
}

void LRealStr__AppendFraction(LongInts__LongInt n, short int sigFigs, short int place, unsigned char* str, int str_0d) {
  register int i0, i1, i2, i3, i4;
  int d;
  unsigned char lstr[64];
  (void)memcpy((void*) (int)lstr, (const void*) (int)_c3, 1);
  i0 = sigFigs < 1;
  if (i0) goto l1;
  i1 = 1;
l0:
  i1++;
  d = (int)i0;
  d = (int)i0;
  LongInts__DivDigit((short int*)(int)n, (int)10, (int *)(int)&d);
  i0 = sigFigs < i1;
  LRealStr__AppendDigit((int)d, (unsigned char*)(int)lstr, 64);
  if (i0) goto l1;
  i0 = d;
  goto l0;
l1:
  i3 = sigFigs - 1;
  i0 = i3 < 0;
  if (i0) goto l4;
  i0 = 0;
  i1 = i3;
l2:
  i4 = place == i0;
  if (!(i4)) goto l3;
  Strings__Append((const unsigned char*)(int)_c4, 2, (unsigned char*)(int)str, str_0d);
l3:
  i4 = (int)lstr + i1;
  i0++;
  i4 = *(unsigned char*)i4;
  i2 = i0 <= i3;
  LRealStr__AppendChar((unsigned char)i4, (unsigned char*)(int)str, str_0d);
  i1--;
  if (i2) goto l2;
l4:
  i1 = place - 1;
  i0 = sigFigs > i1;
  if (i0) goto l6;
  i0 = sigFigs;
l5:
  i0++;
  i2 = i0 <= i1;
  Strings__Append((const unsigned char*)(int)_c5, 2, (unsigned char*)(int)str, str_0d);
  if (i2) goto l5;
l6:
  ;
}

void LRealStr__RemoveLeadingZeros(unsigned char* str, int str_0d) {
  register int i0, i1, i2, i3;
  i2 = Strings__Length((const unsigned char*)(int)str, str_0d);
  i0 = i2 <= 1;
  if (i0) goto l1;
  i1 = *(unsigned char*)(int)str;
  i1 = i1 != 48;
  if (i1) goto l1;
  i3 = (int)str + 1;
  i0 = *(unsigned char*)i3;
  i0 = i0 == 46;
  if (i0) goto l1;
l0:
  i2--;
  i1 = i2 <= 1;
  Strings__Delete((unsigned char*)(int)str, str_0d, (short int)0, (short int)1);
  if (i1) goto l1;
  i1 = *(unsigned char*)(int)str;
  i1 = i1 != 48;
  if (i1) goto l1;
  i1 = *(unsigned char*)i3;
  i1 = i1 != 46;
  if (i1) goto l0;
l1:
  ;
}

int LRealStr__MaxDigit(LongInts__LongInt n) {
  register int i0, i1, i2, i3, i4;
  i0 = 0;
l0:
  i2 = (int)_ashl(i0, 1, (unsigned int));
  i2 = (int)n + i2;
  i1 = *(short int*)i2;
  i3 = i1 != 0;
  if (i3) goto l1;
  goto l4;
l1:
  i2 = i1 >= 10;
  if (i2) goto l2;
  i4 = i1;
  goto l4;
l2:
  i4 = i1;
l3:
  _div(i4, i4, 10, int);
  i2 = i4 >= 10;
  if (i2) goto l3;
l4:
  i0++;
  if (i3) goto l5;
  i2 = i0 <= 169;
  if (i2) goto l0;
l5:
  if (i3) goto l6;
  i4 = 0;
l6:
  return (int)i4;
}

void LRealStr__Scale(double x, LongInts__LongInt n, short int sigFigs, short int exp, unsigned char *overflow) {
  register int i0, i1, i2, i3, i4;
  register double d0, d1;
  int d;
  *overflow = 0;
  i0 = LowLReal__exponent((double)x);
  i0 = i0 == -1022;
  if (i0) goto l0;
  d0 = x;
  i1 = 0;
  goto l2;
l0:
  i1 = 0;
  d0 = x;
l1:
  d0 *= 2.0000000000000000;
  i0 = LowLReal__exponent((double)d0);
  i1--;
  i0 = i0 == -1022;
  if (i0) goto l1;
l2:
  i0 = LowLReal__exponent((double)d0);
  i3 = i1 + i0;
  _mod(i0, i3, 15, int);
  d0 = LowLReal__fraction((double)d0);
  d1 = LowLReal__scale((double)d0, (short int)i0);
  i0 = 165;
l3:
  _entier(i2, d1);
  i1 = (int)_ashl(i0, 1, (unsigned int));
  i1 = (int)n + i1;
  *(short int*)i1 = i2;
  i2 = *(short int*)i1;
  d0 = i2;
  i0++;
  d0 = d1 - d0;
  i2 = i0 <= 169;
  d1 = d0 * 3.2768000000000000E+4;
  if (i2) goto l3;
  i2 = 0;
l4:
  i0 = (int)_ashl(i2, 1, (unsigned int));
  i1 = i2 + 1;
  i0 = (int)n + i0;
  i4 = i1 > 164;
  *(short int*)i0 = 0;
  if (i4) goto l5;
  i2 = i1;
  goto l4;
l5:
  _div(i0, i3, 15, int);
  i1 = i0 - 4;
  i2 = i1 >= 0;
  i0 = sigFigs - exp;
  i0--;
  if (i2) goto l9;
  i2 = i0 > 0;
  if (i2) goto l6;
  i2 = i1 + 1;
  LongInts__TenPower((short int*)(int)n, (short int)i0);
  LongInts__BPower((short int*)(int)n, (short int)i2);
  i2 = LRealStr__MaxDigit((short int*)(int)n);
  LongInts__AddDigit((short int*)(int)n, (int)16384);
  LongInts__DivDigit((short int*)(int)n, (int)32768, (int *)(int)&d);
  goto l10;
l6:
  i2 = i1 > 0;
  LongInts__TenPower((short int*)(int)n, (short int)i0);
  if (i2) goto l7;
  i2 = i1 + 1;
  LongInts__BPower((short int*)(int)n, (short int)i2);
  goto l8;
l7:
  i2 = i1 - 1;
  LongInts__BPower((short int*)(int)n, (short int)i2);
l8:
  i2 = LRealStr__MaxDigit((short int*)(int)n);
  LongInts__AddDigit((short int*)(int)n, (int)16384);
  LongInts__DivDigit((short int*)(int)n, (int)32768, (int *)(int)&d);
  goto l10;
l9:
  i1++;
  LongInts__BPower((short int*)(int)n, (short int)i1);
  LongInts__TenPower((short int*)(int)n, (short int)i0);
  i2 = LRealStr__MaxDigit((short int*)(int)n);
  LongInts__AddDigit((short int*)(int)n, (int)16384);
  LongInts__DivDigit((short int*)(int)n, (int)32768, (int *)(int)&d);
l10:
  i0 = i2 == 9;
  if (!(i0)) goto l11;
  i0 = LRealStr__MaxDigit((short int*)(int)n);
  i0 = i0 == 9;
  if (i0) goto l11;
  *overflow = 1;
l11:
  ;
}

void LRealStr__RealToFloat(double real, short int sigFigs, unsigned char* str, int str_0d) {
  register int i0, i1, i2;
  register double d0;
  int d;
  LongInts__LongInt in;
  unsigned char lstr[64];
  unsigned char overflow;
  i0 = LowLReal__IsNaN((double)real);
  i1 = sigFigs <= 0;
  if (!(i0)) goto l0;
  _string_copy((int)str, (int)_c6, str_0d);
l0:
  if (i1) goto l1;
  i1 = sigFigs;
  goto l2;
l1:
  i1 = 15;
l2:
  (void)memcpy((void*) (int)lstr, (const void*) (int)_c3, 1);
  if (i0) goto l11;
  i2 = real < 0.0000000000000000;
  if (i2) goto l3;
  d0 = real;
  goto l4;
l3:
  Strings__Append((const unsigned char*)(int)_c2, 2, (unsigned char*)(int)lstr, 64);
  d0 = - real;
l4:
  i2 = LowLReal__IsInfinity((double)d0);
  if (!(i2)) goto l5;
  Strings__Append((const unsigned char*)(int)_c7, 9, (unsigned char*)(int)lstr, 64);
  _string_copy((int)str, (int)lstr, str_0d);
l5:
  if (i2) goto l11;
  i0 = LowLReal__exponent10((double)d0);
  LRealStr__Scale((double)d0, (short int*)(int)in, (short int)i1, (short int)i0, (unsigned char *)(int)&overflow);
  if (overflow) goto l6;
  i2 = i0;
  goto l9;
l6:
  i2 = i0 >= 0;
  if (i2) goto l7;
  i2 = i0 - 1;
  goto l8;
l7:
  i2 = i0 + 1;
l8:
  LongInts__DivDigit((short int*)(int)in, (int)10, (int *)(int)&d);
l9:
  LRealStr__AppendFraction((short int*)(int)in, (short int)i1, (short int)1, (unsigned char*)(int)lstr, 64);
  i0 = i2 == 0;
  if (i0) goto l10;
  LRealStr__AppendExponent((short int)i2, (unsigned char*)(int)lstr, 64);
l10:
  _string_copy((int)str, (int)lstr, str_0d);
l11:
  ;
}

void LRealStr__RealToEng(double real, short int sigFigs, unsigned char* str, int str_0d) {
  register int i0, i1, i2, i3;
  register double d0;
  int d;
  LongInts__LongInt in;
  unsigned char lstr[64];
  unsigned char overflow;
  i0 = LowLReal__IsNaN((double)real);
  i1 = sigFigs <= 0;
  if (!(i0)) goto l0;
  _string_copy((int)str, (int)_c6, str_0d);
l0:
  if (i1) goto l1;
  i2 = sigFigs;
  goto l2;
l1:
  i2 = 15;
l2:
  (void)memcpy((void*) (int)lstr, (const void*) (int)_c3, 1);
  if (i0) goto l11;
  i1 = real < 0.0000000000000000;
  if (i1) goto l3;
  d0 = real;
  goto l4;
l3:
  Strings__Append((const unsigned char*)(int)_c2, 2, (unsigned char*)(int)lstr, 64);
  d0 = - real;
l4:
  i1 = LowLReal__IsInfinity((double)d0);
  if (!(i1)) goto l5;
  Strings__Append((const unsigned char*)(int)_c7, 9, (unsigned char*)(int)lstr, 64);
  _string_copy((int)str, (int)lstr, str_0d);
l5:
  if (i1) goto l11;
  i3 = LowLReal__exponent10((double)d0);
  LRealStr__Scale((double)d0, (short int*)(int)in, (short int)i2, (short int)i3, (unsigned char *)(int)&overflow);
  if (overflow) goto l6;
  i0 = i3;
  goto l9;
l6:
  i0 = i3 >= 0;
  if (i0) goto l7;
  i0 = i3 - 1;
  goto l8;
l7:
  i0 = i3 + 1;
l8:
  LongInts__DivDigit((short int*)(int)in, (int)10, (int *)(int)&d);
l9:
  _mod(i3, i0, 3, short int);
  i0 -= i3;
  i1 = i3 + 1;
  i3 = i0 == 0;
  LRealStr__AppendFraction((short int*)(int)in, (short int)i2, (short int)i1, (unsigned char*)(int)lstr, 64);
  if (i3) goto l10;
  LRealStr__AppendExponent((short int)i0, (unsigned char*)(int)lstr, 64);
l10:
  _string_copy((int)str, (int)lstr, str_0d);
l11:
  ;
}

void LRealStr__RealToFixed(double real, short int place, unsigned char* str, int str_0d) {
  register int i0, i1, i2, i3, i4, i5;
  register double d0;
  LongInts__LongInt in;
  unsigned char lstr[256];
  unsigned char overflow;
  i0 = LowLReal__IsNaN((double)real);
  if (!(i0)) goto l0;
  _string_copy((int)str, (int)_c6, str_0d);
l0:
  (void)memcpy((void*) (int)lstr, (const void*) (int)_c3, 1);
  i4 = place != 0;
  if (i0) goto l12;
  i3 = real < 0.0000000000000000;
  if (i3) goto l1;
  d0 = real;
  goto l2;
l1:
  Strings__Append((const unsigned char*)(int)_c2, 2, (unsigned char*)(int)lstr, 256);
  d0 = - real;
l2:
  i3 = LowLReal__IsInfinity((double)d0);
  if (!(i3)) goto l3;
  Strings__Append((const unsigned char*)(int)_c7, 9, (unsigned char*)(int)lstr, 256);
  _string_copy((int)str, (int)lstr, str_0d);
l3:
  if (i3) goto l12;
  i1 = place < 0;
  i0 = LowLReal__exponent10((double)d0);
  if (i1) goto l4;
  i2 = place + i0;
  i2++;
  goto l5;
l4:
  i2 = place + i0;
  i2 += 2;
l5:
  LRealStr__Scale((double)d0, (short int*)(int)in, (short int)i2, (short int)i0, (unsigned char *)(int)&overflow);
  if (overflow) goto l6;
  i5 = i0;
  i3 = i2;
  goto l7;
l6:
  i5 = i0 + 1;
  i3 = i2 + 1;
l7:
  i0 = i5 < 0;
  if (i0) goto l8;
  i5++;
  LRealStr__AppendFraction((short int*)(int)in, (short int)i3, (short int)i5, (unsigned char*)(int)lstr, 256);
  LRealStr__RemoveLeadingZeros((unsigned char*)(int)lstr, 256);
  goto l10;
l8:
  if (i1) goto l9;
  i1 = place + 1;
  LRealStr__AppendFraction((short int*)(int)in, (short int)i1, (short int)1, (unsigned char*)(int)lstr, 256);
  goto l10;
l9:
  LRealStr__AppendFraction((short int*)(int)in, (short int)1, (short int)1, (unsigned char*)(int)lstr, 256);
l10:
  if (i4) goto l11;
  Strings__Append((const unsigned char*)(int)_c4, 2, (unsigned char*)(int)lstr, 256);
l11:
  _string_copy((int)str, (int)lstr, str_0d);
l12:
  ;
}

void LRealStr__RealToStr(double real, unsigned char* str, int str_0d) {
  register int i0, i1, i2, i3;
  register double d0;
  unsigned char found;
  short int pos;
  i0 = LowLReal__IsNaN((double)real);
  if (!(i0)) goto l0;
  _string_copy((int)str, (int)_c6, str_0d);
l0:
  i2 = str_0d - 1;
  if (i0) goto l11;
  i1 = real < 0.0000000000000000;
  if (i1) goto l1;
  _string_copy((int)str, (int)_c3, str_0d);
  i0 = 0;
  goto l2;
l1:
  _string_copy((int)str, (int)_c2, str_0d);
  i0 = -1;
l2:
  d0 = _abs(real);
  i1 = LowLReal__IsInfinity((double)d0);
  if (!(i1)) goto l3;
  Strings__Append((const unsigned char*)(int)_c7, 9, (unsigned char*)(int)str, str_0d);
l3:
  if (i1) goto l11;
  i3 = LowLReal__exponent10((double)real);
  i3 = 15 - i3;
  i3 -= 2;
  i1 = i0 + i3;
  i3 = LRealConv__LengthFixedReal((double)real, (short int)i1);
  i0 = i3 <= i2;
  if (i0) goto l7;
  i3 = LRealConv__LengthFloatReal((double)real, (short int)15);
  i1 = i3 <= i2;
  if (i1) goto l5;
  i1 = 15 - i3;
  i0 = i1 + i2;
  i1 = i0 >= 1;
  if (i1) goto l4;
  i0 = 1;
l4:
  LRealStr__RealToFloat((double)real, (short int)i0, (unsigned char*)(int)str, str_0d);
  goto l11;
l5:
  i1 = i3 < i2;
  LRealStr__RealToFloat((double)real, (short int)15, (unsigned char*)(int)str, str_0d);
  Strings__FindNext((const unsigned char*)(int)_c0, 2, (const unsigned char*)(int)str, str_0d, (short int)2, (unsigned char *)(int)&found, (short int *)(int)&pos);
  if (!(i1)) goto l11;
l6:
  i3++;
  i1 = i3 < i2;
  Strings__Insert((const unsigned char*)(int)_c5, 2, (short int)pos, (unsigned char*)(int)str, str_0d);
  if (i1) goto l6;
  goto l11;
l7:
  i0 = i1 < 0;
  LRealStr__RealToFixed((double)real, (short int)i1, (unsigned char*)(int)str, str_0d);
  if (i0) goto l8;
  i1 = i3;
  goto l9;
l8:
  i1 = i3 + 1;
  Strings__Append((const unsigned char*)(int)_c4, 2, (unsigned char*)(int)str, str_0d);
l9:
  i3 = i1 < i2;
  if (!(i3)) goto l11;
l10:
  i1++;
  i3 = i1 < i2;
  Strings__Append((const unsigned char*)(int)_c5, 2, (unsigned char*)(int)str, str_0d);
  if (i3) goto l10;
l11:
  ;
}

void LRealStr_init(void) {
  _mid = _register_module(&LRealStr_md.md, NULL);
}
