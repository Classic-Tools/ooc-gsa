/* file generated by oo2c -- do not edit */
#include "__oo2c.h"
#include "__libc.h"
#include "External.d"

static _ModId _mid;

void External__InitRef(External__Ref ref, signed char mode) {
  register int i0;
  i0 = (int)ref + 4;
  *(void**)(int)ref = (void*)0;
  *(void**)i0 = (void*)0;
  i0 = (int)ref + 8;
  *(signed char*)i0 = mode;
  i0 = (int)ref + 12;
  *(int*)i0 = -1;
}

void External__InitFile(External__File file, signed char mode, const unsigned char* name__ref, int name_0d, const unsigned char* suffix__ref, int suffix_0d) {
  register int i0, i1;
  unsigned char* name;
  unsigned char* suffix;
  char* _old_top_vs = _top_vs;
  _push_value(int, name, name__ref, name_0d);
  _push_value(int, suffix, suffix__ref, suffix_0d);
  External__InitRef((External__Ref)(int)file, (signed char)mode);
  i0 = Strings__Length((const unsigned char*)(int)name, name_0d);
  i1 = i0 + 1;
  i0 = (int)file + 16;
  {
    char *_mem, *_var;
    int* _dim_ptr;
    if(i1 < 0) _invalid_length(i1, _P(2778));
    _mem = GC_malloc_atomic(_not_zero(i1*1)+8);
    if (!_mem) _new_failed(_P(2740));
    _var = _mem+8;
    _dim_ptr = (void*)(_var-4);
    *(--_dim_ptr) = i1;
    i1 = (int)_var;
  }
  *(void**)i0 = (void*)i1;
  i1 = (int)*(void**)i0;
  i0 = *(int*)(i1-8);
  _string_copy(i1, (int)name, i0);
  i0 = Strings__Length((const unsigned char*)(int)suffix, suffix_0d);
  i1 = i0 + 1;
  i0 = (int)file + 20;
  {
    char *_mem, *_var;
    int* _dim_ptr;
    if(i1 < 0) _invalid_length(i1, _P(2859));
    _mem = GC_malloc_atomic(_not_zero(i1*1)+8);
    if (!_mem) _new_failed(_P(2817));
    _var = _mem+8;
    _dim_ptr = (void*)(_var-4);
    *(--_dim_ptr) = i1;
    i1 = (int)_var;
  }
  *(void**)i0 = (void*)i1;
  i0 = (int)*(void**)i0;
  i1 = *(int*)(i0-8);
  _string_copy(i0, (int)suffix, i1);
  i0 = (int)file + 24;
  *(void**)i0 = (void*)0;
  i0 = (int)file + 28;
  *(void**)i0 = (void*)0;
  _top_vs = _old_top_vs;
}

void External__InitLib(External__Lib lib, signed char mode, const unsigned char* name__ref, int name_0d, const unsigned char* version__ref, int version_0d) {
  register int i0, i1;
  unsigned char* name;
  unsigned char* version;
  char* _old_top_vs = _top_vs;
  _push_value(int, name, name__ref, name_0d);
  _push_value(int, version, version__ref, version_0d);
  External__InitRef((External__Ref)(int)lib, (signed char)mode);
  i0 = Strings__Length((const unsigned char*)(int)name, name_0d);
  i1 = i0 + 1;
  i0 = (int)lib + 20;
  {
    char *_mem, *_var;
    int* _dim_ptr;
    if(i1 < 0) _invalid_length(i1, _P(3128));
    _mem = GC_malloc_atomic(_not_zero(i1*1)+8);
    if (!_mem) _new_failed(_P(3091));
    _var = _mem+8;
    _dim_ptr = (void*)(_var-4);
    *(--_dim_ptr) = i1;
    i1 = (int)_var;
  }
  *(void**)i0 = (void*)i1;
  i0 = (int)*(void**)i0;
  i1 = *(int*)(i0-8);
  _string_copy(i0, (int)name, i1);
  i0 = strcmp((const char*) (int)version, (const char*) (int)_c0) == 0;
  if (i0) goto l0;
  i1 = Strings__Length((const unsigned char*)(int)version, version_0d);
  i0 = i1 + 1;
  i1 = (int)lib + 24;
  {
    char *_mem, *_var;
    int* _dim_ptr;
    if(i0 < 0) _invalid_length(i0, _P(3273));
    _mem = GC_malloc_atomic(_not_zero(i0*1)+8);
    if (!_mem) _new_failed(_P(3230));
    _var = _mem+8;
    _dim_ptr = (void*)(_var-4);
    *(--_dim_ptr) = i0;
    i0 = (int)_var;
  }
  *(void**)i1 = (void*)i0;
  i1 = (int)*(void**)i1;
  i0 = *(int*)(i1-8);
  _string_copy(i1, (int)version, i0);
  goto l1;
l0:
  i0 = (int)lib + 24;
  *(void**)i0 = (void*)0;
l1:
  i0 = (int)lib + 28;
  *(void**)i0 = (void*)0;
  i0 = (int)lib + 16;
  *(void**)i0 = (void*)0;
  i0 = (int)lib + 32;
  *(void**)i0 = (void*)0;
  i0 = (int)lib + 36;
  *(void**)i0 = (void*)0;
  i0 = (int)lib + 40;
  *(void**)i0 = (void*)0;
  i0 = (int)lib + 44;
  *(void**)i0 = (void*)0;
  i0 = (int)lib + 48;
  *(signed char*)i0 = 0;
  i0 = (int)lib + 49;
  *(unsigned char*)i0 = 0;
  i0 = (int)lib + 50;
  *(short int*)i0 = 0;
  _top_vs = _old_top_vs;
}

External__File External__NewFile(signed char mode, const unsigned char* name__ref, int name_0d, const unsigned char* suffix__ref, int suffix_0d, int pos) {
  register int i0;
  unsigned char* name;
  unsigned char* suffix;
  char* _old_top_vs = _top_vs;
  _push_value(int, name, name__ref, name_0d);
  _push_value(int, suffix, suffix__ref, suffix_0d);
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(32)+8);
    if (!_mem) _new_failed(_P(3696));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__FileDesc_td.td;
    i0 = (int)_var;
  }
  External__InitFile((External__File)i0, (signed char)mode, (const unsigned char*)(int)name, name_0d, (const unsigned char*)(int)suffix, suffix_0d);
  _top_vs = _old_top_vs;
  return (void*)i0;
}

External__Lib External__GetLib_NewLib(signed char mode, unsigned char* name, int name_0d, unsigned char* version, int version_0d) {
  register int i0, i1, i2;
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(52)+8);
    if (!_mem) _new_failed(_P(4354));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__LibDesc_td.td;
    i0 = (int)_var;
  }
  External__InitLib((External__Lib)i0, (signed char)mode, (const unsigned char*)(int)name, name_0d, (const unsigned char*)(int)version, version_0d);
  i1 = i0 + 16;
  i2 = (int)External__libList;
  *(void**)i1 = (void*)i2;
  External__libList = (void*)i0;
  return (void*)i0;
}

External__Lib External__GetLib(signed char mode, const unsigned char* name__ref, int name_0d, const unsigned char* version__ref, int version_0d) {
  register int i0, i1, i2, i3;
  unsigned char* name;
  unsigned char* version;
  char* _old_top_vs = _top_vs;
  _push_value(int, name, name__ref, name_0d);
  _push_value(int, version, version__ref, version_0d);
  i0 = (int)External__libList;
  i1 = i0 == 0;
  if (i1) goto l1;
  i2 = i0 + 20;
  i2 = (int)*(void**)i2;
  i1 = strcmp((const char*) (int)name, (const char*) i2) == 0;
  if (i1) goto l1;
  i3 = i0;
l0:
  i3 += 16;
  i3 = (int)*(void**)i3;
  i2 = i3 == 0;
  if (i2) goto l2;
  i2 = i3 + 20;
  i2 = (int)*(void**)i2;
  i2 = strcmp((const char*) (int)name, (const char*) i2) != 0;
  if (i2) goto l0;
  goto l2;
l1:
  i3 = i0;
l2:
  i1 = i3 == 0;
  if (i1) goto l4;
  if (mode==4) goto l5;
  if (!(mode==3)) goto l5;
  i1 = i3 + 8;
  i0 = *(signed char*)i1;
  if (!(i0==4)) goto l3;
  *(signed char*)i1 = 3;
  goto l5;
l3:
  if (!(i0==3)) goto l5;
  goto l5;
l4:
  i3 = (int)External__GetLib_NewLib((signed char)mode, (unsigned char*)(int)name, name_0d, (unsigned char*)(int)version, version_0d);
l5:
  _top_vs = _old_top_vs;
  return (void*)i3;
}

void External__ClearLibList(External__Lib leave) {
  register int i0;
  External__libList = (void*)(int)leave;
  i0 = (int)leave + 16;
  *(void**)i0 = (void*)0;
  i0 = (int)leave + 32;
  *(void**)i0 = (void*)0;
  i0 = (int)leave + 36;
  *(void**)i0 = (void*)0;
}

void External__AddName(External__NameList *list, Parameter__String name) {
  register int i0, i1;
  i0 = (int)*list;
  i1 = i0 == 0;
  if (i1) goto l0;
  i1 = i0 + 4;
  i1 = (int)*(void**)i1;
  i1 = strcmp((const char*) i1, (const char*) (int)name) == 0;
  if (i1) goto l1;
  i1 = (int)*(void**)i0;
  External__AddName((External__NameList *)i0, (Parameter__String)(int)name);
  goto l1;
l0:
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(8)+8);
    if (!_mem) _new_failed(_P(5463));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__NameListDesc_td.td;
    i0 = (int)_var;
  }
  i1 = i0 + 4;
  *(void**)i0 = (void*)0;
  *(void**)i1 = (void*)(int)name;
  *list = (void*)i0;
l1:
  ;
}

void External__Append(External__Ref *list, External__Ref ref) {
  register int i0, i1, i2;
  *(void**)(int)ref = (void*)0;
  i1 = (int)*list;
  i0 = i1 == 0;
  if (i0) goto l3;
  i0 = (int)*(void**)i1;
  i0 = i0 != 0;
  if (i0) goto l0;
  i2 = i1;
  goto l2;
l0:
  i2 = i1;
l1:
  i2 = (int)*(void**)i2;
  i0 = (int)*(void**)i2;
  i0 = i0 != 0;
  if (i0) goto l1;
l2:
  *(void**)i2 = (void*)(int)ref;
  goto l4;
l3:
  *list = (void*)(int)ref;
l4:
  ;
}

void External__AppendDep(External__Lib lib, Parameter__String name) {
  register int i0, i1, i2, i3, i4, i5, i6;
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(8)+8);
    if (!_mem) _new_failed(_P(6184));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__DependenceDesc_td.td;
    i5 = (int)_var;
  }
  *(void**)i5 = (void*)0;
  i3 = i5 + 4;
  i0 = (int)lib + 32;
  i1 = *(int*)((int)name-8);
  i1 = (int)External__GetLib((signed char)4, (const unsigned char*)(int)name, i1, (const unsigned char*)(int)_c0, 1);
  i4 = (int)*(void**)i0;
  *(void**)i3 = (void*)i1;
  i1 = i4 == 0;
  if (i1) goto l3;
  i2 = i4 == 0;
  if (i2) goto l1;
  i0 = i4 + 4;
  i1 = (int)*(void**)i3;
  i3 = (int)*(void**)i0;
  i2 = i3 == i1;
  if (i2) goto l1;
  i0 = i4;
l0:
  i6 = (int)*(void**)i0;
  i3 = i6 == 0;
  if (i3) goto l2;
  i3 = i6 + 4;
  i3 = (int)*(void**)i3;
  i3 = i3 == i1;
  if (i3) goto l2;
  i0 = i6;
  goto l0;
l1:
  i0 = i4;
  i6 = i4;
l2:
  i2 = i6 == 0;
  if (!(i2)) goto l4;
  *(void**)i0 = (void*)i5;
  goto l4;
l3:
  *(void**)i0 = (void*)i5;
l4:
  ;
}

void External__AddModule(External__Lib lib, Data__Object module) {
  register int i0, i1, i2, i3;
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(12)+8);
    if (!_mem) _new_failed(_P(6662));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__ModuleIdDesc_td.td;
    i0 = (int)_var;
  }
  i1 = (int)module + 52;
  i1 = (int)*(void**)i1;
  i3 = i0 + 4;
  i2 = (int)module + 20;
  i1 += 24;
  i2 = (int)*(void**)i2;
  *(void**)i3 = (void*)i2;
  i3 = i0 + 8;
  i2 = (int)lib + 36;
  i1 = *(int*)i1;
  *(int*)i3 = i1;
  i1 = (int)*(void**)i2;
  *(void**)i2 = (void*)i0;
  *(void**)i0 = (void*)i1;
}

Parameter__String External__ReadString(BinaryRider__Reader r) {
  register int i0, i1, i2;
  int len;
  i1 = *(int*)((int)r-4);
  i0 = (int)((_Type)i1)->tbprocs[14];
  ((_TBP_BinaryRider__ReaderDesc_ReadNum)i0)((BinaryRider__Reader)(int)r, (int *)(int)&len);
  i0 = len + 1;
  {
    char *_mem, *_var;
    int* _dim_ptr;
    if(i0 < 0) _invalid_length(i0, _P(7196));
    _mem = GC_malloc_atomic(_not_zero(i0*1)+8);
    if (!_mem) _new_failed(_P(7185));
    _var = _mem+8;
    _dim_ptr = (void*)(_var-4);
    *(--_dim_ptr) = i0;
    i0 = (int)_var;
  }
  i1 = (int)((_Type)i1)->tbprocs[4];
  i2 = *(int*)(i0-8);
  ((_TBP_BinaryRider__ReaderDesc_ReadBytes)i1)((BinaryRider__Reader)(int)r, (unsigned char*)i0, i2, (int)0, (int)len);
  i1 = len + i0;
  *(unsigned char*)i1 = 0;
  return (void*)i0;
}

void External__ReadOptionNames_ReadNameList(External__NameList *list, BinaryRider__Reader *External__ReadOptionNames_r) {
  register int i0, i1;
  i0 = (int)*External__ReadOptionNames_r;
  i0 = (int)External__ReadString((BinaryRider__Reader)i0);
  i1 = strcmp((const char*) i0, (const char*) (int)_c0) == 0;
  if (i1) goto l1;
l0:
  i1 = (int)*list;
  External__AddName((External__NameList *)(int)(int)list, (Parameter__String)i0);
  i1 = (int)*External__ReadOptionNames_r;
  i0 = (int)External__ReadString((BinaryRider__Reader)i1);
  i1 = strcmp((const char*) i0, (const char*) (int)_c0) != 0;
  if (i1) goto l0;
l1:
  ;
}

void External__ReadOptionNames(BinaryRider__Reader r, External__NameList *prefix, External__NameList *suffix) {
  register int i0;
  i0 = (int)*prefix;
  External__ReadOptionNames_ReadNameList((External__NameList *)(int)(int)prefix, (BinaryRider__Reader *)&r);
  i0 = (int)*suffix;
  External__ReadOptionNames_ReadNameList((External__NameList *)(int)(int)suffix, (BinaryRider__Reader *)&r);
}

void External__ReadRefList_ReadDependence(External__Lib lib, BinaryRider__Reader *External__ReadRefList_r) {
  register int i0, i1;
  i0 = (int)*External__ReadRefList_r;
  i0 = (int)External__ReadString((BinaryRider__Reader)i0);
  i1 = strcmp((const char*) i0, (const char*) (int)_c0) == 0;
  if (i1) goto l1;
l0:
  External__AppendDep((External__Lib)(int)lib, (Parameter__String)i0);
  i0 = (int)*External__ReadRefList_r;
  i0 = (int)External__ReadString((BinaryRider__Reader)i0);
  i1 = strcmp((const char*) i0, (const char*) (int)_c0) != 0;
  if (i1) goto l0;
l1:
  ;
}

External__Ref External__ReadRefList(BinaryRider__Reader r) {
  register int i0, i1, i2, i3, i4, i5, i6, i7, i8;
  int mode;
  i0 = *(int*)((int)r-4);
  i0 = (int)((_Type)i0)->tbprocs[14];
  ((_TBP_BinaryRider__ReaderDesc_ReadNum)i0)((BinaryRider__Reader)(int)r, (int *)(int)&mode);
  i0 = mode != 0;
  if (i0) goto l0;
  i8 = 0;
  goto l6;
l0:
  i0 = mode;
  i1 = 0;
  i8 = 0;
  i6 = (int)r;
l1:
  if (!(i0<=0 || i0>=3)) goto l2;
  i3 = (int)External__ReadString((BinaryRider__Reader)i6);
  i4 = *(int*)(i3-8);
  i7 = (int)External__GetLib((signed char)3, (const unsigned char*)i3, i4, (const unsigned char*)(int)_c0, 1);
  i3 = i7 + 44;
  i5 = i7 + 40;
  r = (void*)i6;
  r = (void*)i6;
  External__ReadRefList_ReadDependence((External__Lib)i7, (BinaryRider__Reader *)&r);
  i4 = (int)*(void**)i3;
  i2 = (int)*(void**)i5;
  External__ReadOptionNames((BinaryRider__Reader)(int)r, (External__NameList *)i5, (External__NameList *)i3);
  i6 = (int)r;
  goto l3;
l2:
  if (!((i0>=1 && i0<=2))) goto l3;
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(32)+8);
    if (!_mem) _new_failed(_P(8229));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__FileDesc_td.td;
    i7 = (int)_var;
  }
  External__InitFile((External__File)i7, (signed char)i0, (const unsigned char*)(int)_c0, 1, (const unsigned char*)(int)_c0, 1);
  i5 = i7 + 16;
  i4 = (int)External__ReadString((BinaryRider__Reader)i6);
  *(void**)i5 = (void*)i4;
  i5 = i7 + 28;
  i4 = i7 + 24;
  i3 = i7 + 20;
  i2 = (int)External__ReadString((BinaryRider__Reader)i6);
  *(void**)i3 = (void*)i2;
  i3 = (int)*(void**)i5;
  i2 = (int)*(void**)i4;
  External__ReadOptionNames((BinaryRider__Reader)i6, (External__NameList *)i4, (External__NameList *)i5);
l3:
  i2 = i1 == 0;
  if (i2) goto l4;
  *(void**)i1 = (void*)i7;
  goto l5;
l4:
  i8 = i7;
l5:
  i1 = *(int*)(i6-4);
  i1 = (int)((_Type)i1)->tbprocs[14];
  mode = (int)i0;
  mode = (int)i0;
  ((_TBP_BinaryRider__ReaderDesc_ReadNum)i1)((BinaryRider__Reader)i6, (int *)(int)&mode);
  i0 = mode == 0;
  if (i0) goto l6;
  i0 = mode;
  i1 = i7;
  goto l1;
l6:
  return (void*)i8;
}

void External__WriteString(BinaryRider__Writer w, unsigned char* str, int str_0d) {
  register int i0, i1, i2;
  i2 = *(int*)((int)w-4);
  i0 = Strings__Length((const unsigned char*)(int)str, str_0d);
  i1 = (int)((_Type)i2)->tbprocs[13];
  i2 = (int)((_Type)i2)->tbprocs[3];
  ((_TBP_BinaryRider__WriterDesc_WriteNum)i1)((BinaryRider__Writer)(int)w, (int)i0);
  ((_TBP_BinaryRider__WriterDesc_WriteBytes)i2)((BinaryRider__Writer)(int)w, (unsigned char*)(int)str, str_0d, (int)0, (int)i0);
}

void External__WriteOptionNames_WriteNameList(External__NameList list, BinaryRider__Writer *External__WriteOptionNames_w) {
  register int i0, i1, i2, i3;
  i0 = (int)list == 0;
  if (i0) goto l1;
  i2 = (int)list;
l0:
  i0 = i2 + 4;
  i0 = (int)*(void**)i0;
  i3 = *(int*)(i0-8);
  i1 = (int)*External__WriteOptionNames_w;
  External__WriteString((BinaryRider__Writer)i1, (unsigned char*)i0, i3);
  i2 = (int)*(void**)i2;
  i0 = i2 != 0;
  if (i0) goto l0;
l1:
  i0 = (int)*External__WriteOptionNames_w;
  External__WriteString((BinaryRider__Writer)i0, (unsigned char*)(int)External__emptyString, 2);
}

void External__WriteOptionNames(BinaryRider__Writer w, External__NameList prefix, External__NameList suffix) {
  External__WriteOptionNames_WriteNameList((External__NameList)(int)prefix, (BinaryRider__Writer *)&w);
  External__WriteOptionNames_WriteNameList((External__NameList)(int)suffix, (BinaryRider__Writer *)&w);
}

void External__WriteRefList_WriteDependence(External__Dependence depList, BinaryRider__Writer *External__WriteRefList_w) {
  register int i0, i1, i2, i3;
  i0 = (int)depList == 0;
  if (i0) goto l1;
  i2 = (int)depList;
l0:
  i0 = i2 + 4;
  i0 = (int)*(void**)i0;
  i0 += 20;
  i0 = (int)*(void**)i0;
  i3 = *(int*)(i0-8);
  i1 = (int)*External__WriteRefList_w;
  External__WriteString((BinaryRider__Writer)i1, (unsigned char*)i0, i3);
  i2 = (int)*(void**)i2;
  i0 = i2 != 0;
  if (i0) goto l0;
l1:
  i0 = (int)*External__WriteRefList_w;
  External__WriteString((BinaryRider__Writer)i0, (unsigned char*)(int)External__emptyString, 2);
}

void External__WriteRefList(BinaryRider__Writer w, External__Ref list) {
  register int i0, i1, i2, i3, i4, i5;
  i0 = (int)list != 0;
  if (i0) goto l0;
  i4 = (int)w;
  i5 = 0;
  goto l7;
l0:
  i1 = (int)list;
  i4 = (int)w;
l1:
  i2 = *(int*)(i4-4);
  i0 = i1 + 8;
  i5 = *(signed char*)i0;
  i0 = *(int*)(i1-4);
  i3 = _type_test(i0, &External__FileDesc_td.td, 1);
  i2 = (int)((_Type)i2)->tbprocs[13];
  ((_TBP_BinaryRider__WriterDesc_WriteNum)i2)((BinaryRider__Writer)i4, (int)i5);
  if (i3) goto l4;
  i0 = _type_test(i0, &External__LibDesc_td.td, 1);
  if (i0) goto l2;
  i2 = i4;
  goto l3;
l2:
  i2 = i1 + 20;
  i2 = (int)*(void**)i2;
  i5 = *(int*)(i2-8);
  External__WriteString((BinaryRider__Writer)i4, (unsigned char*)i2, i5);
  i2 = i1 + 32;
  i2 = (int)*(void**)i2;
  w = (void*)i4;
  w = (void*)i4;
  External__WriteRefList_WriteDependence((External__Dependence)i2, (BinaryRider__Writer *)&w);
  i2 = i1 + 40;
  i5 = i1 + 44;
  i2 = (int)*(void**)i2;
  i5 = (int)*(void**)i5;
  External__WriteOptionNames((BinaryRider__Writer)(int)w, (External__NameList)i2, (External__NameList)i5);
  i2 = (int)w;
l3:
  i5 = ! i0;
  i4 = i2;
  goto l5;
l4:
  i2 = i1 + 16;
  i0 = (int)*(void**)i2;
  i2 = *(int*)(i0-8);
  External__WriteString((BinaryRider__Writer)i4, (unsigned char*)i0, i2);
  i2 = i1 + 20;
  i0 = (int)*(void**)i2;
  i2 = *(int*)(i0-8);
  External__WriteString((BinaryRider__Writer)i4, (unsigned char*)i0, i2);
  i2 = i1 + 24;
  i0 = i1 + 28;
  i2 = (int)*(void**)i2;
  i0 = (int)*(void**)i0;
  External__WriteOptionNames((BinaryRider__Writer)i4, (External__NameList)i2, (External__NameList)i0);
  i5 = 0;
l5:
  if (i5) goto l6;
  i0 = (int)*(void**)i1;
  i1 = i0;
l6:
  if (i5) goto l7;
  i0 = i1 != 0;
  if (i0) goto l1;
l7:
  if (i5) goto l8;
  i0 = *(int*)(i4-4);
  i0 = (int)((_Type)i0)->tbprocs[13];
  ((_TBP_BinaryRider__WriterDesc_WriteNum)i0)((BinaryRider__Writer)i4, (int)0);
l8:
  ;
}

void External__WriteLibFile_WriteDepList(BinaryRider__Writer w, External__Lib ignore) {
  register int i0, i1, i2, i3;
  i2 = (int)External__libList;
  i0 = i2 == 0;
  if (i0) goto l4;
l0:
  i3 = (int)ignore != i2;
  if (!(i3)) goto l3;
  i1 = i2 + 20;
  i0 = (int)*(void**)i1;
  i1 = *(int*)(i0-8);
  External__WriteString((BinaryRider__Writer)(int)w, (unsigned char*)i0, i1);
  i1 = i2 + 40;
  i0 = i2 + 44;
  i1 = (int)*(void**)i1;
  i0 = (int)*(void**)i0;
  External__WriteOptionNames((BinaryRider__Writer)(int)w, (External__NameList)i1, (External__NameList)i0);
  i1 = i2 + 32;
  i0 = (int)*(void**)i1;
  i1 = i0 == 0;
  if (i1) goto l2;
l1:
  i1 = i0 + 4;
  i1 = (int)*(void**)i1;
  i1 += 20;
  i1 = (int)*(void**)i1;
  i3 = *(int*)(i1-8);
  External__WriteString((BinaryRider__Writer)(int)w, (unsigned char*)i1, i3);
  i0 = (int)*(void**)i0;
  i1 = i0 != 0;
  if (i1) goto l1;
l2:
  External__WriteString((BinaryRider__Writer)(int)w, (unsigned char*)(int)External__emptyString, 2);
l3:
  i3 = i2 + 16;
  i2 = (int)*(void**)i3;
  i3 = i2 != 0;
  if (i3) goto l0;
l4:
  External__WriteString((BinaryRider__Writer)(int)w, (unsigned char*)(int)External__emptyString, 2);
}

void External__WriteLibFile_WriteModList(BinaryRider__Writer w, External__ModuleId modList) {
  register int i0, i1, i2, i3;
  i0 = (int)modList == 0;
  if (i0) goto l1;
  i2 = *(int*)((int)w-4);
  i0 = (int)((_Type)i2)->tbprocs[12];
  i3 = (int)modList;
l0:
  i1 = i3 + 4;
  i1 = (int)*(void**)i1;
  i2 = *(int*)(i1-8);
  External__WriteString((BinaryRider__Writer)(int)w, (unsigned char*)i1, i2);
  i1 = i3 + 8;
  i1 = *(int*)i1;
  ((_TBP_BinaryRider__WriterDesc_WriteLInt)i0)((BinaryRider__Writer)(int)w, (int)i1);
  i3 = (int)*(void**)i3;
  i1 = i3 != 0;
  if (i1) goto l0;
l1:
  External__WriteString((BinaryRider__Writer)(int)w, (unsigned char*)(int)External__emptyString, 2);
}

void External__WriteLibFile(External__Lib lib, const unsigned char* path__ref, int path_0d) {
  register int i0, i1, i2, i3;
  Parameter__Filename fileName;
  unsigned char msg[256];
  Msg__Msg res;
  unsigned char* path;
  char* _old_top_vs = _top_vs;
  _push_value(int, path, path__ref, path_0d);
  i1 = (int)lib + 20;
  i0 = (int)*(void**)i1;
  i2 = *(int*)(i0-8);
  ParamPaths__GeneratePathExt((const unsigned char*)i0, i2, (const unsigned char*)(int)_c1, 4, (unsigned char*)(int)fileName, 256);
  i2 = (int)Files__Tmp((const unsigned char*)(int)fileName, 256, (unsigned int)0x3U, (Msg__Msg *)(int)&res);
  i0 = i2 == 0;
  if (i0) goto l2;
  i0 = (int)BinaryRider__ConnectWriter((Channel__Channel)i2);
  i3 = *(int*)(i0-4);
  i3 = (int)((_Type)i3)->tbprocs[3];
  ((_TBP_BinaryRider__WriterDesc_WriteBytes)i3)((BinaryRider__Writer)i0, (unsigned char*)(int)External__libFileId, 5, (int)0, (int)4);
  i3 = (int)*(void**)i1;
  i1 = *(int*)(i3-8);
  External__WriteString((BinaryRider__Writer)i0, (unsigned char*)i3, i1);
  i3 = (int)lib + 24;
  i3 = (int)*(void**)i3;
  i1 = *(int*)(i3-8);
  External__WriteString((BinaryRider__Writer)i0, (unsigned char*)i3, i1);
  External__WriteString((BinaryRider__Writer)i0, (unsigned char*)(int)path, path_0d);
  i3 = (int)lib + 40;
  i1 = (int)lib + 44;
  i3 = (int)*(void**)i3;
  i1 = (int)*(void**)i1;
  External__WriteOptionNames((BinaryRider__Writer)i0, (External__NameList)i3, (External__NameList)i1);
  External__WriteLibFile_WriteDepList((BinaryRider__Writer)i0, (External__Lib)(int)lib);
  i3 = (int)lib + 36;
  i3 = (int)*(void**)i3;
  External__WriteLibFile_WriteModList((BinaryRider__Writer)i0, (External__ModuleId)i3);
  i3 = (int)*(void**)i0;
  i0 = i3 == 0;
  if (i0) goto l0;
  i0 = *(int*)(i3-4);
  i0 = (int)((_Type)i0)->tbprocs[3];
  ((_TBP_Msg__MsgDesc_GetText)i0)((Msg__Msg)i3, (Msg__String)(int)msg, 256);
  Error__FileError((const unsigned char*)(int)_c2, 24, (const unsigned char*)(int)fileName, 256, (const unsigned char*)(int)msg, 256);
l0:
  i1 = *(int*)(i2-4);
  i0 = (int)((_Type)i1)->tbprocs[7];
  ((_TBP_Files__FileDesc_Register)i0)((Files__File)i2);
  i3 = (int)*(void**)i2;
  i0 = i3 == 0;
  if (i0) goto l1;
  i0 = *(int*)(i3-4);
  i0 = (int)((_Type)i0)->tbprocs[3];
  ((_TBP_Msg__MsgDesc_GetText)i0)((Msg__Msg)i3, (Msg__String)(int)msg, 256);
  Error__FileError((const unsigned char*)(int)_c3, 28, (const unsigned char*)(int)fileName, 256, (const unsigned char*)(int)msg, 256);
l1:
  i0 = (int)((_Type)i1)->tbprocs[5];
  ((_TBP_Files__FileDesc_Close)i0)((Files__File)i2);
  i0 = (int)*(void**)i2;
  i3 = i0 == 0;
  if (i3) goto l3;
  i3 = *(int*)(i0-4);
  i3 = (int)((_Type)i3)->tbprocs[3];
  ((_TBP_Msg__MsgDesc_GetText)i3)((Msg__Msg)i0, (Msg__String)(int)msg, 256);
  Error__FileError((const unsigned char*)(int)_c4, 24, (const unsigned char*)(int)fileName, 256, (const unsigned char*)(int)msg, 256);
  goto l3;
l2:
  i0 = *(int*)((int)res-4);
  i0 = (int)((_Type)i0)->tbprocs[3];
  ((_TBP_Msg__MsgDesc_GetText)i0)((Msg__Msg)(int)res, (Msg__String)(int)msg, 256);
  Error__FileError((const unsigned char*)(int)_c5, 36, (const unsigned char*)(int)fileName, 256, (const unsigned char*)(int)msg, 256);
l3:
  _top_vs = _old_top_vs;
}

void External__ReadLibFile_ReadDepList(BinaryRider__Reader r, External__Lib lib) {
  register int i0, i1, i2, i3, i4, i5;
  i4 = (int)External__ReadString((BinaryRider__Reader)(int)r);
  i0 = (int)*(void**)(int)r;
  i0 = i0 != 0;
  if (i0) goto l3;
  i0 = strcmp((const char*) i4, (const char*) (int)_c0) == 0;
  if (i0) goto l3;
l0:
  i3 = *(int*)(i4-8);
  External__AppendDep((External__Lib)(int)lib, (Parameter__String)i4);
  i1 = (int)External__GetLib((signed char)3, (const unsigned char*)i4, i3, (const unsigned char*)(int)_c0, 1);
  i3 = i1 + 44;
  i4 = i1 + 40;
  i5 = (int)*(void**)i3;
  i2 = (int)*(void**)i4;
  External__ReadOptionNames((BinaryRider__Reader)(int)r, (External__NameList *)i4, (External__NameList *)i3);
  i4 = (int)External__ReadString((BinaryRider__Reader)(int)r);
  i3 = (int)*(void**)(int)r;
  i3 = i3 != 0;
  if (i3) goto l2;
  i3 = strcmp((const char*) i4, (const char*) (int)_c0) == 0;
  if (i3) goto l2;
l1:
  External__AppendDep((External__Lib)i1, (Parameter__String)i4);
  i4 = (int)External__ReadString((BinaryRider__Reader)(int)r);
  i2 = (int)*(void**)(int)r;
  i2 = i2 != 0;
  if (i2) goto l2;
  i2 = strcmp((const char*) i4, (const char*) (int)_c0) != 0;
  if (i2) goto l1;
l2:
  i4 = (int)External__ReadString((BinaryRider__Reader)(int)r);
  i3 = (int)*(void**)(int)r;
  i3 = i3 != 0;
  if (i3) goto l3;
  i3 = strcmp((const char*) i4, (const char*) (int)_c0) != 0;
  if (i3) goto l0;
l3:
  ;
}

void External__ReadLibFile_ReadModList_AddModule(Parameter__String *External__ReadLibFile_ReadModList_name, int *External__ReadLibFile_ReadModList_magicId, External__Lib *External__ReadLibFile_ReadModList_lib) {
  register int i0, i1, i2;
  {
    char *_mem, *_var;
    _mem = GC_malloc(_not_zero(12)+8);
    if (!_mem) _new_failed(_P(13777));
    _var = _mem+8;
    ((_Type*)_var)[-1] = &External__ModuleIdDesc_td.td;
    i0 = (int)_var;
  }
  i1 = i0 + 4;
  i2 = (int)*External__ReadLibFile_ReadModList_name;
  *(void**)i1 = (void*)i2;
  i1 = i0 + 8;
  i2 = *External__ReadLibFile_ReadModList_magicId;
  *(int*)i1 = i2;
  i1 = (int)*External__ReadLibFile_ReadModList_lib;
  i1 += 36;
  i1 = (int)*(void**)i1;
  *(void**)i0 = (void*)i1;
  i2 = (int)*External__ReadLibFile_ReadModList_lib;
  i1 = i2 + 36;
  *(void**)i1 = (void*)i0;
}

void External__ReadLibFile_ReadModList(BinaryRider__Reader r, External__Lib lib) {
  register int i0, i1, i2, i3;
  int magicId;
  Parameter__String name;
  i2 = (int)External__ReadString((BinaryRider__Reader)(int)r);
  i0 = (int)*(void**)(int)r;
  i0 = i0 != 0;
  if (i0) goto l1;
  i0 = strcmp((const char*) i2, (const char*) (int)_c0) == 0;
  if (i0) goto l1;
  i3 = *(int*)((int)r-4);
  i1 = (int)((_Type)i3)->tbprocs[13];
l0:
  magicId = (int)i3;
  magicId = (int)i3;
  ((_TBP_BinaryRider__ReaderDesc_ReadLInt)i1)((BinaryRider__Reader)(int)r, (int *)(int)&magicId);
  name = (void*)i2;
  External__ReadLibFile_ReadModList_AddModule((Parameter__String *)&name, &magicId, (External__Lib *)&lib);
  i2 = (int)External__ReadString((BinaryRider__Reader)(int)r);
  i3 = (int)*(void**)(int)r;
  i3 = i3 != 0;
  if (i3) goto l1;
  i3 = strcmp((const char*) i2, (const char*) (int)_c0) == 0;
  if (i3) goto l1;
  i3 = magicId;
  goto l0;
l1:
  ;
}

void External__ReadLibFile(External__Lib lib, int pos) {
  register int i0, i1, i2, i3, i4, i5, i6, i7, i8;
  Files__File f;
  Parameter__Filename fileName;
  unsigned char libId[16];
  unsigned char msg[256];
  Msg__Msg res;
  i0 = (int)lib + 36;
  i0 = (int)*(void**)i0;
  i0 = i0 != 0;
  if (i0) goto l7;
  i7 = (int)lib + 20;
  i6 = (int)*(void**)i7;
  i5 = *(int*)(i6-8);
  i6 = ParamPaths__FindPathExt((const unsigned char*)i6, i5, (const unsigned char*)(int)_c1, 4, (unsigned char)0, (unsigned char*)(int)fileName, 256);
  if (i6) goto l0;
  goto l1;
l0:
  i1 = (int)Files__Old((const unsigned char*)(int)fileName, 256, (unsigned int)0x1U, (Msg__Msg *)(int)&res);
l1:
  if (!(i6)) goto l6;
  i0 = i1 == 0;
  if (i0) goto l6;
  i8 = (int)BinaryRider__ConnectReader((Channel__Channel)i1);
  i3 = *(int*)(i8-4);
  (void)memcpy((void*) (int)libId, (const void*) (int)_c6, 5);
  i6 = (int)((_Type)i3)->tbprocs[4];
  ((_TBP_BinaryRider__ReaderDesc_ReadBytes)i6)((BinaryRider__Reader)i8, (unsigned char*)(int)libId, 16, (int)0, (int)4);
  i6 = strcmp((const char*) (int)libId, (const char*) (int)External__libFileId) != 0;
  i4 = *(int*)(i1-4);
  if (i6) goto l3;
  i2 = (int)External__ReadString((BinaryRider__Reader)i8);
  i5 = (int)*(void**)i7;
  i7 = strcmp((const char*) i2, (const char*) i5) == 0;
  if (i7) goto l2;
  i7 = *(int*)(i2-8);
  i6 = *(int*)(i5-8);
  Error__ErrIns2((int)pos, (short int)-602, (const unsigned char*)i2, i7, (const unsigned char*)i5, i6);
l2:
  i7 = (int)External__ReadString((BinaryRider__Reader)i8);
  i5 = (int)lib + 24;
  *(void**)i5 = (void*)i7;
  i2 = (int)External__ReadString((BinaryRider__Reader)i8);
  i6 = (int)lib + 40;
  i7 = (int)lib + 44;
  i5 = (int)lib + 28;
  *(void**)i5 = (void*)i2;
  i5 = (int)*(void**)i7;
  i2 = (int)*(void**)i6;
  External__ReadOptionNames((BinaryRider__Reader)i8, (External__NameList *)i6, (External__NameList *)i7);
  External__ReadLibFile_ReadDepList((BinaryRider__Reader)i8, (External__Lib)(int)lib);
  i7 = (int)((_Type)i4)->tbprocs[0];
  External__ReadLibFile_ReadModList((BinaryRider__Reader)i8, (External__Lib)(int)lib);
  i5 = (int)((_Type)i3)->tbprocs[0];
  i7 = ((_TBP_PosixFileDescr__ChannelDesc_Length)i7)((PosixFileDescr__Channel)i1);
  i5 = ((_TBP_BinaryRider__ReaderDesc_Pos)i5)((BinaryRider__Reader)i8);
  i5 = i7 - i5;
  i7 = i5 == 0;
  if (i7) goto l4;
  IntStr__IntToStr((int)i5, (unsigned char*)(int)libId, 16);
  Error__ErrIns2((int)pos, (short int)-402, (const unsigned char*)(int)libId, 16, (const unsigned char*)(int)fileName, 256);
  goto l4;
l3:
  Error__ErrIns((int)pos, (short int)515, (const unsigned char*)(int)fileName, 256);
l4:
  i6 = (int)*(void**)i8;
  i5 = i6 == 0;
  if (i5) goto l5;
  i5 = *(int*)(i6-4);
  i5 = (int)((_Type)i5)->tbprocs[3];
  ((_TBP_Msg__MsgDesc_GetText)i5)((Msg__Msg)i6, (Msg__String)(int)msg, 256);
  Error__FileError((const unsigned char*)(int)_c7, 23, (const unsigned char*)(int)fileName, 256, (const unsigned char*)(int)msg, 256);
l5:
  i6 = (int)((_Type)i4)->tbprocs[5];
  ((_TBP_Files__FileDesc_Close)i6)((Files__File)i1);
  goto l7;
l6:
  Error__ErrIns((int)pos, (short int)514, (const unsigned char*)(int)fileName, 256);
l7:
  i0 = (int)lib + 49;
  *(unsigned char*)i0 = 0;
}

void External__ClearMarks(void) {
  register int i0, i1;
  i0 = (int)External__libList;
  i1 = i0 == 0;
  if (i1) goto l1;
l0:
  i1 = i0 + 48;
  *(signed char*)i1 = 0;
  i1 = i0 + 16;
  i0 = (int)*(void**)i1;
  i1 = i0 != 0;
  if (i1) goto l0;
l1:
  ;
}

void External__MarkLib(External__Lib lib, unsigned char o2Lib) {
  register int i0, i1;
  if (o2Lib) goto l0;
  i1 = (int)lib + 48;
  i0 = *(signed char*)i1;
  i0 = i0 != 0;
  if (i0) goto l2;
  *(signed char*)i1 = 1;
  goto l2;
l0:
  i1 = (int)lib + 48;
  i0 = *(signed char*)i1;
  i0 = i0 == 2;
  if (i0) goto l2;
  *(signed char*)i1 = 2;
  i1 = (int)lib + 32;
  i1 = (int)*(void**)i1;
  i0 = i1 == 0;
  if (i0) goto l2;
l1:
  i0 = i1 + 4;
  i0 = (int)*(void**)i0;
  External__MarkLib((External__Lib)i0, (unsigned char)0);
  i1 = (int)*(void**)i1;
  i0 = i1 != 0;
  if (i0) goto l1;
l2:
  ;
}

External__Ref External__SortMarkedLibraries(void) {
  register int i0, i1, i2, i3, i4, i5, i6;
  i1 = (int)External__libList;
  i0 = i1 == 0;
  if (i0) goto l1;
l0:
  i0 = i1 + 50;
  *(short int*)i0 = 0;
  i0 = i1 + 16;
  i1 = (int)*(void**)i0;
  i0 = i1 != 0;
  if (i0) goto l0;
l1:
  i4 = (int)External__libList;
  i0 = i4 == 0;
  if (i0) goto l5;
l2:
  i0 = i4 + 48;
  i0 = *(signed char*)i0;
  i0 = i0 == 0;
  if (i0) goto l4;
  i3 = i4 + 32;
  i1 = (int)*(void**)i3;
  i3 = i1 == 0;
  if (i3) goto l4;
l3:
  i0 = i1 + 4;
  i0 = (int)*(void**)i0;
  i3 = i0 + 50;
  i2 = *(short int*)i3;
  i1 = (int)*(void**)i1;
  i2++;
  *(short int*)i3 = i2;
  i0 = i1 != 0;
  if (i0) goto l3;
l4:
  i0 = i4 + 16;
  i4 = (int)*(void**)i0;
  i0 = i4 != 0;
  if (i0) goto l2;
l5:
  i0 = 0;
l6:
  i5 = (int)External__libList;
  i6 = i5 == 0;
  if (i6) goto l7;
  i2 = i5 + 48;
  i2 = *(signed char*)i2;
  i2 = i2 == 0;
  if (i2) goto l8;
  i2 = i5 + 50;
  i2 = *(short int*)i2;
  i2 = i2 != 0;
  if (i2) goto l8;
l7:
  i2 = i5;
  goto l10;
l8:
  i2 = i5;
l9:
  i2 += 16;
  i2 = (int)*(void**)i2;
  i6 = i2 == 0;
  if (i6) goto l10;
  i6 = i2 + 48;
  i6 = *(signed char*)i6;
  i6 = i6 == 0;
  if (i6) goto l9;
  i6 = i2 + 50;
  i6 = *(short int*)i6;
  i6 = i6 != 0;
  if (i6) goto l9;
l10:
  i3 = i2 == 0;
  if (i3) goto l13;
  i4 = i2 + 4;
  *(void**)i4 = (void*)i0;
  i4 = i2 + 48;
  *(signed char*)i4 = 0;
  i4 = i2 + 32;
  i5 = (int)*(void**)i4;
  i4 = i5 == 0;
  if (i4) goto l12;
l11:
  i4 = i5 + 4;
  i4 = (int)*(void**)i4;
  i6 = i4 + 50;
  i1 = *(short int*)i6;
  i5 = (int)*(void**)i5;
  i1--;
  *(short int*)i6 = i1;
  i4 = i5 != 0;
  if (i4) goto l11;
l12:
  i0 = i2;
l13:
  if (!(i3)) goto l6;
  i2 = (int)External__libList;
  i1 = i2 == 0;
  if (i1) goto l15;
  i3 = i2 + 48;
  i3 = *(signed char*)i3;
  i1 = i3 != 0;
  if (i1) goto l15;
  i4 = i2;
l14:
  i4 += 16;
  i4 = (int)*(void**)i4;
  i3 = i4 == 0;
  if (i3) goto l16;
  i3 = i4 + 48;
  i3 = *(signed char*)i3;
  i3 = i3 == 0;
  if (i3) goto l14;
  goto l16;
l15:
  i4 = i2;
l16:
  i1 = i4 != 0;
  if (!(i1)) goto l17;
  Parameter__FatalError((const unsigned char*)(int)_c8, 54);
l17:
  i1 = i0 != 0;
  if (i1) goto l18;
  i4 = 0;
  goto l20;
l18:
  i4 = i0;
  i2 = 0;
l19:
  i1 = i4 + 4;
  i3 = (int)*(void**)i1;
  *(void**)i1 = (void*)i2;
  i1 = i3 == 0;
  if (i1) goto l20;
  i2 = i4;
  i4 = i3;
  goto l19;
l20:
  return (void*)i4;
}

void External_init(void) {
  register int i0, i1;
  _mid = _register_module(&External_md.md, &External__ModuleIdDesc_td.td);
  External__libList = (void*)0;
  i1 = (int)External__libFileId + 1;
  *(unsigned char*)(int)External__libFileId = 239;
  i0 = (int)External__libFileId + 2;
  *(unsigned char*)i1 = 154;
  i1 = (int)External__libFileId + 3;
  *(unsigned char*)i0 = 82;
  i0 = (int)External__libFileId + 4;
  *(unsigned char*)i1 = 108;
  *(unsigned char*)i0 = 0;
  (void)memcpy((void*) (int)External__emptyString, (const void*) (int)_c0, 1);
}
