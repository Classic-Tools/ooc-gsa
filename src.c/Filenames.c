/* file generated by oo2c -- do not edit */
#include "__oo2c.h"
#include "__libc.h"
#include "Filenames.d"

static _ModId _mid;

short int Filenames__LocateCharLast(const unsigned char* str__ref, int str_0d, unsigned char ch) {
  register int i0, i1, i2, i3;
  unsigned char* str;
  char* _old_top_vs = _top_vs;
  _push_value(int, str, str__ref, str_0d);
  i1 = Strings__Length((const unsigned char*)(int)str, str_0d);
  i0 = i1 >= 0;
  if (i0) goto l0;
  i2 = 0;
  goto l3;
l0:
  i0 = (int)str + i1;
  i0 = *(unsigned char*)i0;
  i2 = (int)ch == i0;
  if (i2) goto l1;
  i0 = i1 - 1;
  i1 = i0;
  goto l2;
l1:
  i3 = i1;
l2:
  if (i2) goto l3;
  i0 = i1 >= 0;
  if (i0) goto l0;
l3:
  if (i2) goto l4;
  i3 = -1;
l4:
  _top_vs = _old_top_vs;
  return (short int)i3;
}

void Filenames__SplitRChar(const unsigned char* str__ref, int str_0d, unsigned char* str1, int str1_0d, unsigned char* str2, int str2_0d, unsigned char ch) {
  register int i0, i1, i2;
  unsigned char* str;
  char* _old_top_vs = _top_vs;
  _push_value(int, str, str__ref, str_0d);
  i2 = Strings__Length((const unsigned char*)(int)str, str_0d);
  i1 = Filenames__LocateCharLast((const unsigned char*)(int)str, str_0d, (unsigned char)(int)ch);
  i0 = i1 >= 0;
  _string_copy((int)str2, (int)str, str2_0d);
  if (i0) goto l0;
  _string_copy((int)str1, (int)_c0, str1_0d);
  goto l1;
l0:
  i1++;
  _string_copy((int)str1, (int)str, str1_0d);
  i2 -= i1;
  Strings__Delete((unsigned char*)(int)str2, str2_0d, (short int)0, (short int)i1);
  Strings__Delete((unsigned char*)(int)str1, str1_0d, (short int)i1, (short int)i2);
l1:
  _top_vs = _old_top_vs;
}

void Filenames__GetPath(const unsigned char* full__ref, int full_0d, unsigned char* path, int path_0d, unsigned char* file, int file_0d) {
  unsigned char* full;
  char* _old_top_vs = _top_vs;
  _push_value(int, full, full__ref, full_0d);
  Filenames__SplitRChar((const unsigned char*)(int)full, full_0d, (unsigned char*)(int)path, path_0d, (unsigned char*)(int)file, file_0d, (unsigned char)47);
  _top_vs = _old_top_vs;
}

void Filenames__GetExt(const unsigned char* full__ref, int full_0d, unsigned char* file, int file_0d, unsigned char* ext, int ext_0d) {
  register int i0, i1;
  unsigned char* full;
  char* _old_top_vs = _top_vs;
  _push_value(int, full, full__ref, full_0d);
  i1 = Filenames__LocateCharLast((const unsigned char*)(int)full, full_0d, (unsigned char)47);
  i0 = Filenames__LocateCharLast((const unsigned char*)(int)full, full_0d, (unsigned char)46);
  i0 = i1 < i0;
  if (i0) goto l0;
  _string_copy((int)file, (int)full, file_0d);
  _string_copy((int)ext, (int)_c0, ext_0d);
  goto l1;
l0:
  Filenames__SplitRChar((const unsigned char*)(int)full, full_0d, (unsigned char*)(int)file, file_0d, (unsigned char*)(int)ext, ext_0d, (unsigned char)46);
  i0 = Strings__Length((const unsigned char*)(int)file, file_0d);
  i0--;
  Strings__Delete((unsigned char*)(int)file, file_0d, (short int)i0, (short int)1);
l1:
  _top_vs = _old_top_vs;
}

void Filenames__GetFile(const unsigned char* full__ref, int full_0d, unsigned char* file, int file_0d) {
  unsigned char dummy[256];
  unsigned char* full;
  char* _old_top_vs = _top_vs;
  _push_value(int, full, full__ref, full_0d);
  Filenames__GetPath((const unsigned char*)(int)full, full_0d, (unsigned char*)(int)dummy, 256, (unsigned char*)(int)file, file_0d);
  Filenames__GetExt((const unsigned char*)(int)file, file_0d, (unsigned char*)(int)file, file_0d, (unsigned char*)(int)dummy, 256);
  _top_vs = _old_top_vs;
}

void Filenames__AddExt(unsigned char* full, int full_0d, const unsigned char* file__ref, int file_0d, const unsigned char* ext__ref, int ext_0d) {
  register int i0;
  unsigned char* file;
  unsigned char* ext;
  char* _old_top_vs = _top_vs;
  _push_value(int, file, file__ref, file_0d);
  _push_value(int, ext, ext__ref, ext_0d);
  i0 = *(unsigned char*)(int)ext;
  i0 = i0 == 0;
  _string_copy((int)full, (int)file, full_0d);
  if (i0) goto l0;
  Strings2__AppendChar((unsigned char)46, (unsigned char*)(int)full, full_0d);
  Strings__Append((const unsigned char*)(int)ext, ext_0d, (unsigned char*)(int)full, full_0d);
l0:
  _top_vs = _old_top_vs;
}

void Filenames__AddPath(unsigned char* full, int full_0d, const unsigned char* path__ref, int path_0d, const unsigned char* file__ref, int file_0d) {
  register int i0, i1;
  unsigned char* path;
  unsigned char* file;
  char* _old_top_vs = _top_vs;
  _push_value(int, path, path__ref, path_0d);
  _push_value(int, file, file__ref, file_0d);
  i0 = *(unsigned char*)(int)path;
  i0 = i0 == 0;
  _string_copy((int)full, (int)file, full_0d);
  if (i0) goto l1;
  i1 = Strings__Length((const unsigned char*)(int)path, path_0d);
  i1--;
  i0 = (int)path + i1;
  i1 = *(unsigned char*)i0;
  i1 = i1 == 47;
  if (i1) goto l0;
  Strings__Insert((const unsigned char*)(int)_c1, 2, (short int)0, (unsigned char*)(int)full, full_0d);
l0:
  Strings__Insert((const unsigned char*)(int)path, path_0d, (short int)0, (unsigned char*)(int)full, full_0d);
l1:
  _top_vs = _old_top_vs;
}

void Filenames__BuildFilename(unsigned char* full, int full_0d, const unsigned char* path__ref, int path_0d, const unsigned char* file__ref, int file_0d, const unsigned char* ext__ref, int ext_0d) {
  unsigned char* path;
  unsigned char* file;
  unsigned char* ext;
  char* _old_top_vs = _top_vs;
  _push_value(int, path, path__ref, path_0d);
  _push_value(int, file, file__ref, file_0d);
  _push_value(int, ext, ext__ref, ext_0d);
  Filenames__AddExt((unsigned char*)(int)full, full_0d, (const unsigned char*)(int)file, file_0d, (const unsigned char*)(int)ext, ext_0d);
  Filenames__AddPath((unsigned char*)(int)full, full_0d, (const unsigned char*)(int)path, path_0d, (const unsigned char*)(int)full, full_0d);
  _top_vs = _old_top_vs;
}

void Filenames__ExpandPath(unsigned char* full, int full_0d, const unsigned char* path__ref, int path_0d) {
  register int i0, i1, i2;
  unsigned char suffix[256];
  unsigned char username[32];
  unsigned char userpath[256];
  unsigned char* path;
  char* _old_top_vs = _top_vs;
  _push_value(int, path, path__ref, path_0d);
  i0 = *(unsigned char*)(int)path;
  i0 = i0 != 126;
  _string_copy((int)full, (int)path, full_0d);
  if (i0) goto l2;
  i2 = Strings2__PosChar((unsigned char)47, (const unsigned char*)(int)path, path_0d);
  i0 = i2 < 0;
  i1 = Strings__Length((const unsigned char*)(int)path, path_0d);
  if (i0) goto l0;
  i0 = i2 + 1;
  goto l1;
l0:
  i0 = i1;
  i2 = i1;
l1:
  i1 -= i0;
  Strings__Extract((const unsigned char*)(int)path, path_0d, (short int)i0, (short int)i1, (unsigned char*)(int)suffix, 256);
  i1 = i2 - 1;
  Strings__Extract((const unsigned char*)(int)path, path_0d, (short int)1, (short int)i1, (unsigned char*)(int)username, 32);
  Rts_GetUserHome((unsigned char*)(int)userpath, (const unsigned char*)(int)username);
  i1 = *(unsigned char*)(int)userpath;
  i1 = i1 == 0;
  if (i1) goto l2;
  Filenames__AddPath((unsigned char*)(int)full, full_0d, (const unsigned char*)(int)userpath, 256, (const unsigned char*)(int)suffix, 256);
l2:
  _top_vs = _old_top_vs;
}

void Filenames_init(void) {
  _mid = _register_module(&Filenames_md.md, NULL);
}
