/* file generated by oo2c -- do not edit */
#include "__oo2c.h"
#include "__libc.h"
#include "RCS.d"

static _ModId _mid;

unsigned char RCS__MasterFile(const unsigned char* fileName__ref, int fileName_0d) {
  register int i0, i1;
  unsigned char found;
  short int i;
  unsigned char* fileName;
  char* _old_top_vs = _top_vs;
  _push_value(int, fileName, fileName__ref, fileName_0d);
  i1 = Strings__Length((const unsigned char*)(int)fileName, fileName_0d);
  i0 = Strings__Length((const unsigned char*)(int)_c0, 3);
  i0 = i1 - i0;
  i1 = i0 <= 0;
  if (i1) goto l2;
  Strings__FindNext((const unsigned char*)(int)_c0, 3, (const unsigned char*)(int)fileName, fileName_0d, (short int)i0, (unsigned char *)(int)&found, (short int *)(int)&i);
  if (!(found)) goto l0;
  i0 = i == i0;
  if (i0) goto l1;
l0:
  i1 = 0;
  goto l3;
l1:
  i1 = 1;
  goto l3;
l2:
  i1 = 0;
l3:
  _top_vs = _old_top_vs;
  return (unsigned char)i1;
}

void RCS__Master2File(const unsigned char* rcsFile__ref, int rcsFile_0d, unsigned char* workFile, int workFile_0d) {
  register int i0, i1, i2, i3;
  unsigned char dir[256];
  unsigned char dirpath[256];
  unsigned char file[256];
  unsigned char path[256];
  unsigned char* rcsFile;
  char* _old_top_vs = _top_vs;
  _push_value(int, rcsFile, rcsFile__ref, rcsFile_0d);
  Filenames__GetPath((const unsigned char*)(int)rcsFile, rcsFile_0d, (unsigned char*)(int)path, 256, (unsigned char*)(int)file, 256);
  i1 = Strings__Length((const unsigned char*)(int)file, 256);
  i0 = strcmp((const char*) (int)path, (const char*) (int)_c1) == 0;
  i2 = Strings__Length((const unsigned char*)(int)_c0, 3);
  if (i0) goto l1;
  i0 = Strings__Length((const unsigned char*)(int)path, 256);
  i3 = i0 - 1;
  i0 = (int)path + i3;
  i0 = *(unsigned char*)i0;
  i0 = i0 != 47;
  if (i0) goto l0;
  i3 = Strings__Length((const unsigned char*)(int)path, 256);
  i3--;
  i0 = (int)path + i3;
  *(unsigned char*)i0 = 0;
l0:
  Filenames__GetPath((const unsigned char*)(int)path, 256, (unsigned char*)(int)dirpath, 256, (unsigned char*)(int)dir, 256);
  i0 = strcmp((const char*) (int)dir, (const char*) (int)_c2) != 0;
  if (i0) goto l1;
  _string_copy((int)path, (int)dirpath, 256);
l1:
  i0 = i1 - i2;
  i1 = (int)file + i0;
  *(unsigned char*)i1 = 0;
  Filenames__BuildFilename((unsigned char*)(int)workFile, workFile_0d, (const unsigned char*)(int)path, 256, (const unsigned char*)(int)file, 256, (const unsigned char*)(int)_c1, 1);
  _top_vs = _old_top_vs;
}

unsigned char RCS__CheckOut(unsigned char* fileName, int fileName_0d, unsigned char* resultMsg, int resultMsg_0d) {
  register int i0;
  unsigned char com[768];
  i0 = Files__Exists((const unsigned char*)(int)fileName, fileName_0d);
  if (i0) goto l0;
  _string_copy((int)resultMsg, (int)_c3, resultMsg_0d);
  Strings__Append((const unsigned char*)(int)fileName, fileName_0d, (unsigned char*)(int)resultMsg, resultMsg_0d);
  i0 = 0;
  goto l3;
l0:
  (void)memcpy((void*) (int)com, (const void*) (int)_c4, 7);
  RCS__Master2File((const unsigned char*)(int)fileName, fileName_0d, (unsigned char*)(int)fileName, fileName_0d);
  Strings__Append((const unsigned char*)(int)fileName, fileName_0d, (unsigned char*)(int)com, 768);
  i0 = Rts_System((const unsigned char*)(int)com);
  i0 = i0 != 0;
  if (i0) goto l1;
  _string_copy((int)resultMsg, (int)com, resultMsg_0d);
  goto l2;
l1:
  _string_copy((int)resultMsg, (int)com, resultMsg_0d);
  Strings__Insert((const unsigned char*)(int)_c5, 2, (short int)0, (unsigned char*)(int)resultMsg, resultMsg_0d);
  Strings__Append((const unsigned char*)(int)_c6, 9, (unsigned char*)(int)resultMsg, resultMsg_0d);
l2:
  i0 = ! i0;
l3:
  return (unsigned char)i0;
}

unsigned char RCS__FindMasterFile(unsigned char* fileName, int fileName_0d) {
  register int i0;
  unsigned char file[256];
  unsigned char master[256];
  unsigned char path[256];
  Filenames__GetPath((const unsigned char*)(int)fileName, fileName_0d, (unsigned char*)(int)path, 256, (unsigned char*)(int)file, 256);
  Strings__Append((const unsigned char*)(int)_c0, 3, (unsigned char*)(int)file, 256);
  Filenames__AddPath((unsigned char*)(int)master, 256, (const unsigned char*)(int)path, 256, (const unsigned char*)(int)_c2, 4);
  Filenames__BuildFilename((unsigned char*)(int)master, 256, (const unsigned char*)(int)master, 256, (const unsigned char*)(int)file, 256, (const unsigned char*)(int)_c1, 1);
  i0 = Files__Exists((const unsigned char*)(int)master, 256);
  if (i0) goto l0;
  Filenames__BuildFilename((unsigned char*)(int)master, 256, (const unsigned char*)(int)path, 256, (const unsigned char*)(int)file, 256, (const unsigned char*)(int)_c1, 1);
l0:
  i0 = Files__Exists((const unsigned char*)(int)master, 256);
  if (!(i0)) goto l1;
  _string_copy((int)fileName, (int)master, fileName_0d);
l1:
  return (unsigned char)i0;
}

void RCS_init(void) {
  _mid = _register_module(&RCS_md.md, NULL);
}
